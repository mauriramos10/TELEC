<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ELECTRICIDAD</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- PapaParse para leer CSV -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <style>
    .btn { 
      display:inline-flex; 
      align-items:center; 
      gap:.5rem; 
      padding:.5rem .75rem; 
      border-radius:.75rem; 
      font-size:14px; 
      border:1px solid #ea580c; 
      color:#ea580c;
      background:#fff;
      transition: all 0.2s;
    }
    .btn:hover { background:#ea580c; color:#fff; }
    .btn.active { background:#ea580c; color:#fff; border-color:#ea580c; }
    .card { box-shadow: 0 10px 30px rgba(2,6,23,.06); }
    .muted { color:#64748b; }
    .input { width:100%; border:1px solid #cbd5e1; border-radius:.75rem; padding:.5rem .75rem; font-size:14px; }
    .label { font-size: .875rem; color:#0f172a; font-weight:500; }
    .alert { color: #dc2626; font-weight: 500; }
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-900">
  <!-- Encabezado -->
  <section class="max-w-6xl mx-auto p-3 md:p-6">
    <div class="card bg-white rounded-2xl p-5 md:p-7 flex items-center gap-4 md:gap-8">
      <div class="flex items-center gap-3 shrink-0">
        <img src="cb57cd89e9da2498ff60b8362abf3cc9.png" alt="Logo Pantaleon" class="h-24 w-auto">
      </div>
      <div class="text-center grow">
        <div class="text-lg md:text-xl font-semibold">ELECTRICIDAD</div>
        <div class="muted text-sm">Área</div>
      </div>
      <div class="text-right shrink-0 leading-tight">
        <div class="font-semibold" id="clock">--:--:--</div>
        <div class="muted text-sm" id="dateLabel">—</div>
        <div class="muted text-xs">
          Responsable: <span id="responsableNombre" class="font-medium lowercase"></span>
          <button onclick="cambiarResponsable()" 
                  class="ml-2 px-3 py-1.5 bg-orange-500 text-white rounded-lg text-xs hover:bg-orange-600 transition">
            Cambiar
          </button>
        </div>
      </div>
    </div>
    <div class="text-center muted text-sm mt-2">Ingenio Pantaleon · Ubicación: Guatemala</div>
  </section>

  <main class="max-w-6xl mx-auto p-3 md:p-6 space-y-6">
    <!-- NUMERO DE EQUIPO SAP -->
    <section class="bg-white rounded-2xl border card p-4 md:p-6">
      <h2 class="text-lg font-semibold mb-3">NUMERO DE EQUIPO SAP</h2>
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <label class="label" for="sapEquipo">EQUIPO SAP:</label>
          <input id="sapEquipo" type="text" class="input mt-1" placeholder="Ej. 1002345" />
        </div>
        <div>
          <label class="label" for="sapNombre">NOMBRE DEL EQUIPO:</label>
          <input id="sapNombre" type="text" class="input mt-1" readonly />
        </div>
      </div>
      <div id="sapError" class="alert mt-2 hidden"></div>
    </section>

    <!-- DESCRIPCIÓN DEL EQUIPO -->
    <section class="bg-white rounded-2xl border card p-4 md:p-6">
      <h2 class="text-lg font-semibold mb-3">DESCRIPCIÓN DEL EQUIPO</h2>
      <div id="descEquipo" class="text-sm text-slate-700">—</div>
    </section>

    <!-- CALIDAD DE MANTENIMIENTO -->
    <section class="bg-white rounded-2xl border card p-4 md:p-6">
      <h2 class="text-lg font-semibold mb-3">CALIDAD DE MANTENIMIENTO</h2>
      <div id="calidadEquipo" class="text-sm text-slate-700">—</div>
    </section>
  </main>

  <script>
    // Reloj/fecha
    const clockEl = document.getElementById("clock");
    const dateEl = document.getElementById("dateLabel");
    function updateClock(){
      const now = new Date();
      const hh = String(now.getHours()).padStart(2,"0");
      const mm = String(now.getMinutes()).padStart(2,"0");
      const ss = String(now.getSeconds()).padStart(2,"0");
      clockEl.textContent = `${hh}:${mm}:${ss}`;
      const fmt = new Intl.DateTimeFormat("es-ES", { weekday:"long", day:"2-digit", month:"long", year:"numeric" });
      const txt = fmt.format(now);
      dateEl.textContent = txt.charAt(0).toUpperCase() + txt.slice(1);
    }
    updateClock(); setInterval(updateClock, 1000);

    // Cambiar responsable
    function cambiarResponsable(){
      const nuevo = prompt("Ingrese el nombre del responsable:");
      if(nuevo && nuevo.trim() !== ""){
        document.getElementById("responsableNombre").textContent = nuevo;
      }
    }

    let csvData = [];

    // Cargar CSV automáticamente
    Papa.parse("avisos.csv", {
      download: true,
      header: true,
      complete: function(results) {
        csvData = results.data;
      }
    });

    // Buscar SAP automáticamente
    document.getElementById("sapEquipo").addEventListener("change", function(){
      const sap = this.value.trim();
      const errorEl = document.getElementById("sapError");
      const sapNombre = document.getElementById("sapNombre");
      const desc = document.getElementById("descEquipo");
      const calidad = document.getElementById("calidadEquipo");

      if(!sap){
        errorEl.textContent = "Ingrese un número SAP válido.";
        errorEl.classList.remove("hidden");
        return;
      }

      // Coincidencia parcial
      const match = csvData.find(row => String(row["SAP"] || "").includes(sap));

      if(match){
        errorEl.classList.add("hidden");
        sapNombre.value = match["NOMBRE"] || "—";
        desc.textContent = match["DESCRIPCION"] || "—";
        calidad.textContent = match["CALIDAD"] || "—";
      } else {
        errorEl.textContent = "No se encontró información para este SAP";
        errorEl.classList.remove("hidden");
        sapNombre.value = "";
        desc.textContent = "—";
        calidad.textContent = "—";
      }
    });
  </script>
</body>
</html>